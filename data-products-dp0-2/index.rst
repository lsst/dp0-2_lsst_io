.. Review the README on instructions to contribute.
.. Review the style guide to keep a consistent approach to the documentation.
.. Static objects, such as figures, should be stored in the _static directory. Review the _static/README on instructions to contribute.
.. Do not remove the comments that describe each section. They are included to provide guidance to contributors.
.. Do not remove other content provided in the templates, such as a section. Instead, comment out the content and include comments to explain the situation. For example:
	- If a section within the template is not needed, comment out the section title and label reference. Do not delete the expected section title, reference or related comments provided from the template.
    - If a file cannot include a title (surrounded by ampersands (#)), comment out the title from the template and include a comment explaining why this is implemented (in addition to applying the ``title`` directive).

.. This is the label that can be used for cross referencing this file.
.. Recommended title label format is "Directory Name"-"Title Name" -- Spaces should be replaced by hyphens.
.. _Data-Products-DP0-2-Data-Products:
.. Each section should include a label for cross referencing to a given area.
.. Recommended format for all labels is "Title Name"-"Section Name" -- Spaces should be replaced by hyphens.
.. To reference a label that isn't associated with an reST object such as a title or figure, you must include the link and explicit title using the syntax :ref:`link text <label-name>`.
.. A warning will alert you of identical labels during the linkcheck process.

###################
DP0.2 Data Products
###################

.. This section should provide a brief, top-level description of the page.


.. _DP0-2-Data-Products-Introduction:

The DESC DC2 Data Set
=====================

DP0 is based on the the simulated, Legacy Survey of Space and Time (LSST)-like images generated by the Dark Energy Science Collaboration (DESC) for their Data Challenge 2 (DC2; `arXiv:2010.05926 <https://arxiv.org/abs/2010.05926>`_).
DP0 only uses the 300 \deg\ :sup:`2` of DC2 images that were simulated for five years of the LSST's wide-fast-deep component (WFD; also called the main survey) with a baseline cadence (i.e., a fiducial observing strategy).
For more information about the LSST regions and cadence see `Ivezic et al. (2019) <https://ui.adsabs.harvard.edu/abs/2019ApJ...873..111I/abstract>`_.

**Simulated Objects and Images:**
The DC2's WFD simulated images include galaxies (with large-scale structure), Type Ia supernovae, and stars (10% of which are variable).
DP0.2 does not include AGN, strong lenses, solar system objects, non-Ia extragalactic transients, or diffuse features (e.g., tidal streams, intracluster light).
The DESC simulated the DC2 images using the `imSim <https://github.com/LSSTDESC/imSim>`__ package.

**Image Processing:**
The DESC processed the simulated DC2 images with `Version 23 <https://pipelines.lsst.io/v/v23_0_0/index.html>`_ of the LSST Science Pipelines.
DP0.2 makes the DESC's DC2 images and catalogs available to RSP users.
For DP0.2, the Rubin Data Production team will reprocess the same images with the most up-to-date version of the LSST Science Pipelines, and release the resulting images and catalogs in mid-2022.

.. toctree::
    :maxdepth: 2
    :glob:

    data-processing


.. _DP0-2-Data-Products-DPDD:

DP0.2 Data Products Definition Document (DPDD)
==============================================

**The DC2 data set is being made available for use on a shared-risk basis, and the LSST Science Pipelines which produced these images and catalogs is in active development.**

Future data previews and Operations-era LSST data releases will produce images and catalogs that more closely resemble the plan laid out in the `Data Products Definitions Document <https://ls.st/dpdd/>`_ (DPDD).
Several of the future data products (e.g., specific table columns) that are listed in the DPDD are not available for DP0.

.. _DP0-2-Data-Products-DPDD-Images:

Images
------

The three main types of images available for DP0.2 are processed visit images, coadded images, and difference images.

**Processed Visit Images** (PVIs; **calexps**):
A fully-qualified LSST image from a single visit (in other words, a single pointing) that includes the science pixel array, a quality mask, and a variance array,
in addition to a PSF characterization and metadata (including calibration metadata) about the image.
PVIs are stored with the background already subtracted.
A single CCD of a PVI is called a "calexp".

There are many associated data products that are accessible alongside PVIs.
These include the background ("calexpBackground") that was subtracted from the "calexp", which can be retrieved separately.
Each PVI also has an associated mask plane that encodes quality and other information about each pixel,
a WCS solution to be used in converting between pixel and sky coordinates,
a photometric calibration object to be used in converting between fluxes and magnitudes for astronomical sources,
and a model of the point-spread function (PSF) at each position on the image.

**Coadded Images** (**deepCoadd**):
An image that is the combination of multiple input images, often referred to as a "coadd" or a "deepCoadd".
The input images have been aligned to a common projection and pixel grid;
corrected to the same photometric scale, zero-point, and point-spread function (PSF);
and had bad pixels, artifacts, and transient and variable object flux removed prior to combination.
Coadds are stored with the non-astrophysical background already subtracted.
As with PVIs, the coadds also have associated data products including the background model that has been subtracted,
the mask and variance planes associated with the image, a WCS solution, photometric calibration, and a PSF model.

Coadd images are divided into **"tracts"** (a spherical convex polygon) and tracts are divided into **"patches"** (a quadrilateral sub-region, with a size in pixels chosen to fit easily into memory on desktop computers, about the same size as a "calexp").

.. figure:: /_static/dpdd_dc2_zoom.png
    :name: dpdd_dc2_zoom
    
    Figure 15 from `The LSST DESC DC2 Simulated Sky Survey <https://ui.adsabs.harvard.edu/abs/2021ApJS..253...31L/abstract>`_, showing the simulated WFD region divided into tracts.
    The center image is one tract quadrant, and the right image one hundredth the area of the tract quadrant. Patches are larger than the right image, as described in the DESC's paper:
    *"each tract is composed of 7 × 7 patches, and each patch is 4,100 × 4,100 pixels with a pixel scale of 0.2 arcsec"*.

**Difference Images**:
A PVI which has had a template image subtracted from it.
Template images are built from images obtained the previous year.
Any source detected in a difference image represents the *time-variable* flux component of the astrophysical object.

.. _DP0-2-Data-Products-DPDD-Catalogs:

Catalogs
--------

Source detection, measurement, and characterization have been run on the PVIs, coadds, and difference images to generate catalog data.
Catalog data are accessible with the :ref:`Data-Access-Analysis-Tools-TAP` via the Portal or Notebook Aspect, and with the Butler via the Notebook Aspect.

**DP0.2 Table Schema:**
The column names, units, and descriptions of the DP0.2 catalogs listed in the table below are all available via the `DP0.2 schema browser <https://dm.lsst.org/sdm_schemas/browser/dp02.html>`_.

.. list-table:: Catalog data available for DP0.2.
   :widths: 100 100 390
   :header-rows: 1

   * - TAP Name
     - Butler Name
     - Description
   * - Object
     - objectTable
     - Astrometric and photometric measurements for objects detected in coadded images (990 columns).
   * - Source
     - sourceTable
     - Astrometric and photometric measurements for sources detected in the individual PVIs (143 columns).
   * - ForcedSource
     - forcedSourceTable
     - Forced photometry on the individual PVIs at the locations of all detected objects and sources (38 columns).
   * - DiaObject
     - diaObjectTable_tract
     - Derived summary parameters for DiaSources associated by sky location, including lighcurve statistics (137 columns).
   * - DiaSource
     - diaSourceTable_tract
     - Astrometric and photometric measurements for sources detected in the difference images (66 columns).
   * - ForcedSourceOnDiaObject
     - forcedSourceOnDiaObjectTable_tract
     - Forced photometry on the individual PVIs at the locations of all DiaObjects (35 columns).
   * - Visit
     - visitTable
     - Individual visit information, including band, airmass, exposure time, and so on (15 columns).
   * - CcdVisit
     - ccdVisitTable
     - Individual CCD (detecor) information, including measured seeing, sky background, and zeropoint (30 columns).

|

**Principal Columns:**
For convenience, Rubin Observatory staff have identified the principal columns which are most likely to be useful.
These principal columns will be pre-selected in the Table View of the RSP's Portal Aspect.

**Recommended Search Parameter "detect_isPrimary = True":**
A good default search query parameter for the Object, Source, and ForcedSource catalogs is to set **detect_isPrimary** = **True**.
The ``detect_isPrimary`` parameter is ``True`` if a source has no children, is in the inner region of a coadd patch, is in the inner region of a coadd tract, and is not “detected” in a pseudo-filter.
Setting ``detect_isPrimary`` to ``True`` will remove any duplicates, sky objects, etc.

**Additional butler catalogs** can also be found by querying the collections in the butler registry.
Some tables require different types of inputs: for example, "diaSourceTable" can be queried with a dataId that includes the visit,
whereas "diaSourceTable_tract" can be queried with a dataId that includes the tract number.

**Truth catalog data** will also be available via TAP and the Butler.
More information to come.
